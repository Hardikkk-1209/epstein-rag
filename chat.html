<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Epstein Files ‚Äî Research Terminal</title>
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;1,300&family=Bebas+Neue&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #080808;
      --surface: #0f0f0f;
      --surface2: #141414;
      --border: rgba(255, 255, 255, 0.06);
      --accent: #e8c547;
      --accent-dim: rgba(232, 197, 71, 0.12);
      --accent-glow: rgba(232, 197, 71, 0.04);
      --red: #c0392b;
      --text: #ffffff;
      --text-dim: #ffffff;
      --text-muted: #ffffff;
      --user-bg: #131313;
      --bot-bg: #0c0c0c;
      --toggle-bg: #1a1a1a;
      --toggle-border: rgba(255, 255, 255, 0.1);
    }

    [data-theme="light"] {
      --bg: #d4cfc8;
      --surface: #d4cfc8;
      --surface2: #d4cfc8;
      --border: rgba(0, 0, 0, 0.08);
      --accent: #b8860b;
      --accent-dim: rgba(184, 134, 11, 0.1);
      --accent-glow: rgba(184, 134, 11, 0.04);
      --red: #c0392b;
      --text: #000000;
      --text-dim: #000000;
      --text-muted: #000000;
      --user-bg: #d4cfc8;
      ;
      --bot-bg: #f0ebe0;
      --toggle-bg: #ddd8cc;
      --toggle-border: rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'IBM Plex Mono', monospace;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Scanline effect - only in dark mode */
    [data-theme="dark"] body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(0deg,
          transparent,
          transparent 2px,
          rgba(0, 0, 0, 0.03) 2px,
          rgba(0, 0, 0, 0.03) 4px);
      pointer-events: none;
      z-index: 1000;
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      opacity: 0.025;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 999;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      height: 56px;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      flex-shrink: 0;
      position: relative;
      z-index: 10;
      transition: background 0.3s ease, border-color 0.3s ease;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-text {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 22px;
      letter-spacing: 0.15em;
      color: var(--accent);
    }

    .header-divider {
      width: 1px;
      height: 20px;
      background: var(--border);
    }

    .header-sub {
      font-size: 10px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-dim);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .status-dot {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #2ecc71;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.3;
      }
    }

    .doc-count {
      font-size: 10px;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      background: var(--surface2);
      border: 1px solid var(--border);
      padding: 4px 10px;
      border-radius: 4px;
    }

    .doc-count span {
      color: var(--accent);
    }

    /* ‚îÄ‚îÄ THEME TOGGLE ‚îÄ‚îÄ */
    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 6px 12px;
      background: var(--toggle-bg);
      border: 1px solid var(--toggle-border);
      border-radius: 20px;
      transition: all 0.2s ease;
      user-select: none;
    }

    .theme-toggle:hover {
      border-color: var(--accent);
    }

    .toggle-track {
      width: 32px;
      height: 16px;
      background: var(--border);
      border-radius: 8px;
      position: relative;
      transition: background 0.3s ease;
      border: 1px solid var(--toggle-border);
    }

    [data-theme="light"] .toggle-track {
      background: var(--accent-dim);
      border-color: var(--accent);
    }

    .toggle-thumb {
      width: 10px;
      height: 10px;
      background: var(--text-dim);
      border-radius: 50%;
      position: absolute;
      top: 2px;
      left: 2px;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .toggle-thumb {
      left: 18px;
      background: var(--accent);
    }

    .toggle-icon {
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .toggle-label {
      font-size: 9px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
      transition: color 0.3s ease;
    }

    /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
    .layout {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
    .sidebar {
      width: 248px;
      border-right: 1px solid var(--border);
      background: var(--surface);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
      transition: background 0.3s ease, border-color 0.3s ease;
    }

    .sidebar::-webkit-scrollbar {
      width: 3px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: transparent;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: var(--border);
    }

    /* Section wrapper */
    .sb-section {
      border-bottom: 1px solid var(--border);
      padding: 0;
    }

    /* Section header (collapsible trigger) */
    .sb-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px 10px;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s;
    }

    .sb-head:hover {
      background: rgba(255, 255, 255, 0.02);
    }

    .sb-head-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .sb-label {
      font-size: 8.5px;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: var(--text-muted);
      font-weight: 500;
    }

    .sb-section-icon {
      font-size: 10px;
      color: var(--text-muted);
      opacity: 0.7;
    }

    .sb-chevron {
      font-size: 9px;
      color: var(--text-muted);
      transition: transform 0.2s ease;
      opacity: 0.5;
    }

    .sb-section.collapsed .sb-chevron {
      transform: rotate(-90deg);
    }

    /* Section body */
    .sb-body {
      overflow: hidden;
      transition: max-height 0.25s ease, opacity 0.2s ease;
      max-height: 400px;
      opacity: 1;
    }

    .sb-section.collapsed .sb-body {
      max-height: 0;
      opacity: 0;
    }

    /* ‚îÄ‚îÄ SESSION ‚îÄ‚îÄ */
    .sb-terminal-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px 10px;
      border-left: 2px solid var(--accent);
      background: var(--accent-dim);
      margin: 0 0 6px;
    }

    .sb-terminal-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #2ecc71;
      flex-shrink: 0;
      animation: pulse 2s infinite;
    }

    .sb-terminal-label {
      font-size: 11px;
      color: var(--accent);
      letter-spacing: 0.06em;
    }

    .sb-recent-label {
      font-size: 8px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 4px 16px 6px;
    }

    .sb-recent-list {
      padding: 0 0 8px;
    }

    .sb-recent-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 16px;
      font-size: 10px;
      color: var(--text-dim);
      cursor: pointer;
      letter-spacing: 0.03em;
      line-height: 1.4;
      border-left: 2px solid transparent;
      transition: all 0.15s;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sb-recent-item:hover {
      color: var(--text);
      background: var(--accent-glow);
      border-left-color: rgba(232, 197, 71, 0.4);
    }

    .sb-recent-icon {
      font-size: 9px;
      opacity: 0.4;
      flex-shrink: 0;
    }

    .sb-recent-empty {
      padding: 6px 16px 10px;
      font-size: 10px;
      color: var(--text-muted);
      font-style: italic;
      letter-spacing: 0.03em;
    }

    /* ‚îÄ‚îÄ ACTIVE CONTEXT ‚îÄ‚îÄ */
    .sb-context-grid {
      padding: 4px 16px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .sb-ctx-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 9.5px;
      letter-spacing: 0.04em;
    }

    .sb-ctx-key {
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      font-size: 8.5px;
    }

    .sb-ctx-val {
      color: var(--accent);
      font-size: 10px;
      font-weight: 500;
    }

    .sb-ctx-val.green {
      color: #2ecc71;
    }

    .sb-source-tags {
      padding: 0 16px 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .sb-tag {
      font-size: 8px;
      padding: 2px 7px;
      border-radius: 3px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      border: 1px solid rgba(232, 197, 71, 0.25);
      color: rgba(232, 197, 71, 0.7);
      background: rgba(232, 197, 71, 0.05);
    }

    /* ‚îÄ‚îÄ KEY FIGURES ‚îÄ‚îÄ */
    .sb-figures-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      padding: 4px 12px 12px;
    }

    .sb-figure-btn {
      padding: 5px 8px;
      font-size: 9.5px;
      color: var(--text-dim);
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 3px;
      cursor: pointer;
      letter-spacing: 0.03em;
      transition: all 0.15s;
      text-align: left;
      font-family: 'IBM Plex Mono', monospace;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sb-figure-btn:hover {
      color: var(--accent);
      border-color: rgba(232, 197, 71, 0.35);
      background: var(--accent-dim);
    }

    /* ‚îÄ‚îÄ DOCUMENTS ‚îÄ‚îÄ */
    .sb-doc-nav {
      padding: 2px 0 4px;
    }

    .sb-doc-item {
      display: flex;
      align-items: center;
      gap: 9px;
      padding: 7px 16px;
      font-size: 10.5px;
      color: var(--text-dim);
      cursor: pointer;
      border-left: 2px solid transparent;
      letter-spacing: 0.04em;
      transition: all 0.15s;
    }

    .sb-doc-item:hover {
      color: var(--text);
      background: var(--accent-glow);
      border-left-color: rgba(232, 197, 71, 0.4);
    }

    .sb-doc-icon {
      font-size: 11px;
      opacity: 0.5;
    }

    .sb-filter-label {
      font-size: 8px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 6px 16px 4px;
    }

    .sb-filters {
      padding: 2px 16px 12px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .sb-filter-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sb-filter-name {
      font-size: 10px;
      color: var(--text-dim);
      letter-spacing: 0.03em;
    }

    .sb-toggle {
      width: 28px;
      height: 14px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 7px;
      border: 1px solid var(--border);
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .sb-toggle.on {
      background: rgba(232, 197, 71, 0.25);
      border-color: rgba(232, 197, 71, 0.4);
    }

    .sb-toggle::after {
      content: '';
      position: absolute;
      width: 9px;
      height: 9px;
      background: var(--text-muted);
      border-radius: 50%;
      top: 1.5px;
      left: 2px;
      transition: all 0.2s;
    }

    .sb-toggle.on::after {
      left: 15px;
      background: var(--accent);
    }

    /* ‚îÄ‚îÄ AI CONTROLS ‚îÄ‚îÄ */
    .sb-modes {
      padding: 4px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .sb-mode-btn {
      display: flex;
      align-items: center;
      gap: 9px;
      padding: 7px 10px;
      font-size: 10px;
      color: var(--text-dim);
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      letter-spacing: 0.04em;
      transition: all 0.15s;
      font-family: 'IBM Plex Mono', monospace;
      text-align: left;
    }

    .sb-mode-btn:hover {
      color: var(--text);
      border-color: rgba(232, 197, 71, 0.3);
      background: var(--accent-glow);
    }

    .sb-mode-btn.active {
      color: var(--accent);
      border-color: rgba(232, 197, 71, 0.45);
      background: var(--accent-dim);
    }

    .sb-mode-icon {
      font-size: 11px;
      opacity: 0.7;
    }

    .sb-mode-active-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--accent);
      margin-left: auto;
      flex-shrink: 0;
      display: none;
    }

    .sb-mode-btn.active .sb-mode-active-dot {
      display: block;
    }

    /* ‚îÄ‚îÄ DEBUG PANEL ‚îÄ‚îÄ */
    .sb-debug-grid {
      padding: 4px 16px 12px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .sb-dbg-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sb-dbg-key {
      font-size: 8.5px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .sb-dbg-val {
      font-size: 9px;
      color: #4a9eff;
      letter-spacing: 0.05em;
    }

    .sb-dbg-val.amber {
      color: var(--accent);
    }

    .sb-dbg-val.green {
      color: #2ecc71;
    }

    .sb-dbg-val.dim {
      color: var(--text-dim);
    }

    .sb-latency-badge {
      font-size: 8px;
      padding: 1px 6px;
      border-radius: 2px;
      background: rgba(74, 158, 255, 0.1);
      border: 1px solid rgba(74, 158, 255, 0.2);
      color: #4a9eff;
      letter-spacing: 0.05em;
    }

    /* ‚îÄ‚îÄ SIDEBAR WARNING ‚îÄ‚îÄ */
    .sidebar-warning {
      margin: 12px 12px 16px;
      padding: 10px 12px;
      background: rgba(192, 57, 43, 0.06);
      border: 1px solid rgba(192, 57, 43, 0.18);
      border-radius: 5px;
      font-size: 8.5px;
      line-height: 1.65;
      color: rgba(192, 57, 43, 0.75);
      letter-spacing: 0.04em;
    }

    .sidebar-warning-icon {
      display: block;
      margin-bottom: 4px;
      font-size: 10px;
    }

    /* ‚îÄ‚îÄ CHAT AREA ‚îÄ‚îÄ */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .breadcrumb {
      padding: 10px 32px;
      font-size: 10px;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .breadcrumb span {
      color: var(--text-dim);
    }

    #chat {
      flex: 1;
      overflow-y: auto;
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 0;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }

    #chat::-webkit-scrollbar {
      width: 4px;
    }

    #chat::-webkit-scrollbar-track {
      background: transparent;
    }

    #chat::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 2px;
    }

    .msg-block {
      display: flex;
      gap: 16px;
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
      animation: fadeIn 0.3s ease;
    }

    .msg-block:last-child {
      border-bottom: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .msg-prefix {
      font-size: 11px;
      letter-spacing: 0.1em;
      min-width: 80px;
      padding-top: 2px;
      flex-shrink: 0;
    }

    .msg-prefix.user-prefix {
      color: var(--accent);
    }

    .msg-prefix.bot-prefix {
      color: var(--red);
    }

    .msg-content {
      flex: 1;
      font-size: 13px;
      line-height: 1.8;
      color: var(--text);
      letter-spacing: 0.02em;
    }

    .msg-content.user-content {
      color: var(--text-dim);
    }

    .sources-block {
      margin-top: 12px;
      padding: 10px 14px;
      background: var(--accent-dim);
      border: 1px solid rgba(232, 197, 71, 0.15);
      border-radius: 4px;
      font-size: 10px;
      letter-spacing: 0.12em;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .loading-dots {
      display: flex;
      gap: 4px;
      align-items: center;
      padding-top: 4px;
    }

    .loading-dots span {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--accent);
      animation: blink 1.2s infinite;
    }

    .loading-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .loading-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes blink {

      0%,
      80%,
      100% {
        opacity: 0.2;
        transform: scale(0.8);
      }

      40% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .welcome {
      padding: 32px 0;
      border-bottom: 1px solid var(--border);
    }

    .welcome-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      letter-spacing: 0.1em;
      color: var(--accent);
      margin-bottom: 12px;
      line-height: 1;
    }

    .welcome-desc {
      font-size: 12px;
      line-height: 1.8;
      color: var(--text-dim);
      max-width: 560px;
      letter-spacing: 0.03em;
    }

    .suggested {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 20px;
    }

    .suggested-btn {
      padding: 8px 14px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.03em;
    }

    .suggested-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-dim);
    }

    /* ‚îÄ‚îÄ INPUT AREA ‚îÄ‚îÄ */
    .input-area {
      padding: 20px 32px;
      border-top: 1px solid var(--border);
      background: var(--surface);
      flex-shrink: 0;
      transition: background 0.3s ease;
    }

    .input-wrapper {
      display: flex;
      align-items: center;
      gap: 0;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
      transition: border-color 0.2s;
    }

    .input-wrapper:focus-within {
      border-color: rgba(232, 197, 71, 0.4);
    }

    .input-prompt {
      padding: 0 16px;
      font-size: 13px;
      color: var(--accent);
      letter-spacing: 0.05em;
      flex-shrink: 0;
      border-right: 1px solid var(--border);
      height: 48px;
      display: flex;
      align-items: center;
    }

    input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text);
      padding: 14px 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      outline: none;
      letter-spacing: 0.03em;
    }

    input::placeholder {
      color: var(--text-muted);
    }

    button {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 0 24px;
      height: 48px;
      cursor: pointer;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 16px;
      letter-spacing: 0.15em;
      transition: opacity 0.2s;
      flex-shrink: 0;
    }

    button:hover {
      opacity: 0.85;
    }

    button:active {
      opacity: 0.7;
    }

    .input-hint {
      margin-top: 10px;
      font-size: 10px;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .input-hint kbd {
      background: var(--surface2);
      border: 1px solid var(--border);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: inherit;
      font-size: 9px;
    }

    .media-block {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .media-item {
      border: 1px solid rgba(232, 197, 71, 0.2);
      border-radius: 6px;
      overflow: hidden;
      max-width: 280px;
    }

    .media-item img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      display: block;
    }

    .media-item video {
      width: 100%;
      height: 160px;
      object-fit: cover;
      display: block;
    }

    .media-label {
      padding: 6px 10px;
      font-size: 9px;
      letter-spacing: 0.1em;
      color: var(--accent);
      background: var(--accent-dim);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }

      header {
        padding: 0 20px;
      }

      #chat {
        padding: 20px;
      }

      .input-area {
        padding: 16px 20px;
      }

      .header-sub {
        display: none;
      }
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <div class="header-left">
      <div class="logo-text">EPSTEIN FILES rag model</div>
      <div class="header-divider"></div>
      <div class="header-sub">Made By Hardikk (<a href="https://www.linkedin.com/in/hardik-patil-ba1a39306/" target="_blank" style="color: #0077b5; text-decoration: none; letter-spacing: 0.2em; text-transform: none;">LinkedIn</a>)</div>
    </div>
    <div class="header-right">
      <div class="status-dot">
        <div class="dot"></div>
        SYSTEM ONLINE
      </div>
      <div class="doc-count">INDEXED: <span>33715</span> CHUNKS</div>

      <!-- THEME TOGGLE -->
      <div class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <span class="toggle-icon" id="toggle-icon">üåô</span>
        <div class="toggle-track">
          <div class="toggle-thumb"></div>
        </div>
        <span class="toggle-label" id="toggle-label">DARK</span>
      </div>
    </div>
  </header>

  <!-- LAYOUT -->
  <div class="layout">

    <!-- SIDEBAR -->
    <div class="sidebar" id="sidebar">

      <!-- ‚ïê‚ïê‚ïê SESSION ‚ïê‚ïê‚ïê -->
      <div class="sb-section" id="sec-session">
        <div class="sb-head" onclick="toggleSection('sec-session')">
          <div class="sb-head-left">
            <span class="sb-section-icon">‚óà</span>
            <span class="sb-label">Session</span>
          </div>
          <span class="sb-chevron">‚ñæ</span>
        </div>
        <div class="sb-body">
          <div class="sb-terminal-row">
            <div class="sb-terminal-dot"></div>
            <span class="sb-terminal-label">Research Terminal</span>
          </div>
          <div class="sb-recent-label">Recent Queries</div>
          <div class="sb-recent-list" id="recent-queries">
            <div class="sb-recent-empty">No queries yet.</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê ACTIVE CONTEXT ‚ïê‚ïê‚ïê -->
      <div class="sb-section" id="sec-context">
        <div class="sb-head" onclick="toggleSection('sec-context')">
          <div class="sb-head-left">
            <span class="sb-section-icon">‚óé</span>
            <span class="sb-label">Active Context</span>
          </div>
          <span class="sb-chevron">‚ñæ</span>
        </div>
        <div class="sb-body">
          <div class="sb-context-grid">
            <div class="sb-ctx-row">
              <span class="sb-ctx-key">Status</span>
              <span class="sb-ctx-val green">INDEXED</span>
            </div>
            <div class="sb-ctx-row">
              <span class="sb-ctx-key">Chunks Loaded</span>
              <span class="sb-ctx-val" id="ctx-chunks">33,715</span>
            </div>
            <div class="sb-ctx-row">
              <span class="sb-ctx-key">Top-K Results</span>
              <span class="sb-ctx-val">5</span>
            </div>
            <div class="sb-ctx-row">
              <span class="sb-ctx-key">Retrieval</span>
              <span class="sb-ctx-val">FAISS ¬∑ L2</span>
            </div>
          </div>
          <div class="sb-source-tags">
            <span class="sb-tag">SDNY Filing</span>
            <span class="sb-tag">Court Docs</span>
            <span class="sb-tag">Depositions</span>
            <span class="sb-tag">Flight Logs</span>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê KEY FIGURES ‚ïê‚ïê‚ïê -->
      <div class="sb-section" id="sec-figures">
        <div class="sb-head" onclick="toggleSection('sec-figures')">
          <div class="sb-head-left">
            <span class="sb-section-icon">‚óâ</span>
            <span class="sb-label">Key Figures</span>
          </div>
          <span class="sb-chevron">‚ñæ</span>
        </div>
        <div class="sb-body">
          <div class="sb-figures-grid">
            <button class="sb-figure-btn" onclick="insertEntity('Jeffrey Epstein')">Jeffrey Epstein</button>
            <button class="sb-figure-btn" onclick="insertEntity('Ghislaine Maxwell')">G. Maxwell</button>
            <button class="sb-figure-btn" onclick="insertEntity('Virginia Giuffre')">V. Giuffre</button>
            <button class="sb-figure-btn" onclick="insertEntity('Les Wexner')">Les Wexner</button>
            <button class="sb-figure-btn" onclick="insertEntity('Alan Dershowitz')">A. Dershowitz</button>
            <button class="sb-figure-btn" onclick="insertEntity('Prince Andrew')">Prince Andrew</button>
            <button class="sb-figure-btn" onclick="insertEntity('Jean-Luc Brunel')">J-L Brunel</button>
            <button class="sb-figure-btn" onclick="insertEntity('Bill Richardson')">B. Richardson</button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê DOCUMENTS ‚ïê‚ïê‚ïê -->
      <div class="sb-section" id="sec-documents">
        <div class="sb-head" onclick="toggleSection('sec-documents')">
          <div class="sb-head-left">
            <span class="sb-section-icon">‚ó´</span>
            <span class="sb-label">Documents</span>
          </div>
          <span class="sb-chevron">‚ñæ</span>
        </div>
        <div class="sb-body">
          <div class="sb-doc-nav">
            <div class="sb-doc-item">
              <span class="sb-doc-icon">‚óà</span> Document Index
            </div>
            <div class="sb-doc-item">
              <span class="sb-doc-icon">‚óá</span> Timeline
            </div>
          </div>
          <div class="sb-filter-label">Filters</div>
          <div class="sb-filters">
            <div class="sb-filter-row">
              <span class="sb-filter-name">Court Docs</span>
              <div class="sb-toggle on" onclick="toggleFilter(this)" data-filter="court"></div>
            </div>
            <div class="sb-filter-row">
              <span class="sb-filter-name">Depositions</span>
              <div class="sb-toggle on" onclick="toggleFilter(this)" data-filter="depo"></div>
            </div>
            <div class="sb-filter-row">
              <span class="sb-filter-name">Flight Logs</span>
              <div class="sb-toggle on" onclick="toggleFilter(this)" data-filter="flight"></div>
            </div>
            <div class="sb-filter-row">
              <span class="sb-filter-name">Media Evidence</span>
              <div class="sb-toggle on" onclick="toggleFilter(this)" data-filter="media"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê AI CONTROLS ‚ïê‚ïê‚ïê -->
      <div class="sb-section" id="sec-ai">
        <div class="sb-head" onclick="toggleSection('sec-ai')">
          <div class="sb-head-left">
            <span class="sb-section-icon">‚¨°</span>
            <span class="sb-label">AI Controls</span>
          </div>
          <span class="sb-chevron">‚ñæ</span>
        </div>
        <div class="sb-body">
          <div class="sb-modes" id="ai-modes">
            <button class="sb-mode-btn active" data-mode="strict" onclick="setMode(this)">
              <span class="sb-mode-icon">‚óà</span>
              Strict Evidence
              <span class="sb-mode-active-dot"></span>
            </button>
            <button class="sb-mode-btn" data-mode="summary" onclick="setMode(this)">
              <span class="sb-mode-icon">‚óâ</span>
              Summary Mode
              <span class="sb-mode-active-dot"></span>
            </button>
            <button class="sb-mode-btn" data-mode="timeline" onclick="setMode(this)">
              <span class="sb-mode-icon">‚óá</span>
              Timeline Mode
              <span class="sb-mode-active-dot"></span>
            </button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê DEBUG PANEL ‚ïê‚ïê‚ïê -->
      <div class="sb-section collapsed" id="sec-debug">
        <div class="sb-head" onclick="toggleSection('sec-debug')">
          <div class="sb-head-left">
            <span class="sb-section-icon">‚å•</span>
            <span class="sb-label">Debug Panel</span>
          </div>
          <span class="sb-chevron">‚ñæ</span>
        </div>
        <div class="sb-body">
          <div class="sb-debug-grid">
            <div class="sb-dbg-row">
              <span class="sb-dbg-key">Model</span>
              <span class="sb-dbg-val amber">gemini-2.5-flash</span>
            </div>
            <div class="sb-dbg-row">
              <span class="sb-dbg-key">Embedding</span>
              <span class="sb-dbg-val">MiniLM-L6-v2</span>
            </div>
            <div class="sb-dbg-row">
              <span class="sb-dbg-key">Top-K</span>
              <span class="sb-dbg-val dim">5</span>
            </div>
            <div class="sb-dbg-row">
              <span class="sb-dbg-key">Index</span>
              <span class="sb-dbg-val">FAISS ¬∑ L2</span>
            </div>
            <div class="sb-dbg-row">
              <span class="sb-dbg-key">Latency</span>
              <span class="sb-latency-badge" id="dbg-latency">‚Äî ms</span>
            </div>
            <div class="sb-dbg-row">
              <span class="sb-dbg-key">Session</span>
              <span class="sb-dbg-val green" id="dbg-session">ACTIVE</span>
            </div>
            <div class="sb-dbg-row">
              <span class="sb-dbg-key">Queries</span>
              <span class="sb-dbg-val dim" id="dbg-query-count">0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- WARNING -->
      <div class="sidebar-warning">
        <span class="sidebar-warning-icon">‚ö†</span>
        FOR RESEARCH PURPOSES ONLY. CONTENT SOURCED FROM PUBLIC COURT RECORDS.
      </div>

    </div>

    <!-- CHAT -->
    <div class="chat-container">
      <div class="breadcrumb">
        EPSTEIN-RAG / <span>research-terminal</span> / <span>active-session</span>
      </div>

      <div id="chat">
        <div class="welcome">
          <div class="welcome-title">RESEARCH TERMINAL</div>
          <div class="welcome-desc">
            Query the Epstein court document database. All responses are sourced strictly from indexed legal documents.
            This system will not speculate beyond available evidence.
          </div>
          <div class="suggested">
            <div class="suggested-btn" onclick="fillQuery(this)">Who is Ghislaine Maxwell?</div>

            <div class="suggested-btn" onclick="fillQuery(this)">What did Virginia Giuffre claim?</div>

          </div>
        </div>
      </div>

      <!-- INPUT -->
      <div class="input-area">
        <div class="input-wrapper">
          <div class="input-prompt">QUERY://</div>
          <input id="input" type="text" placeholder="Enter your research query..."
            onkeydown="if(event.key==='Enter') sendMessage()">
          <button onclick="sendMessage()">EXECUTE</button>
        </div>
        <div class="input-hint">Press <kbd>ENTER</kbd> to send ¬∑ Responses sourced from indexed documents only</div>
      </div>
    </div>

  </div>

  <script>
    // ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ
    function toggleTheme() {
      const html = document.documentElement;
      const isDark = html.getAttribute("data-theme") === "dark";
      html.setAttribute("data-theme", isDark ? "light" : "dark");
      document.getElementById("toggle-icon").textContent = isDark ? "‚òÄÔ∏è" : "üåô";
      document.getElementById("toggle-label").textContent = isDark ? "LIGHT" : "DARK";
      localStorage.setItem("theme", isDark ? "light" : "dark");
    }

    // Restore saved theme on load
    const savedTheme = localStorage.getItem("theme") || "dark";
    document.documentElement.setAttribute("data-theme", savedTheme);
    if (savedTheme === "light") {
      document.getElementById("toggle-icon").textContent = "‚òÄÔ∏è";
      document.getElementById("toggle-label").textContent = "LIGHT";
    }

    // ‚îÄ‚îÄ Chat ‚îÄ‚îÄ
    function fillQuery(el) {
      document.getElementById("input").value = el.textContent;
      document.getElementById("input").focus();
    }

    async function _sendMessageCore() {
      const input = document.getElementById("input");
      const chat = document.getElementById("chat");
      const question = input.value.trim();
      if (!question) return;

      chat.innerHTML += `
      <div class="msg-block">
        <div class="msg-prefix user-prefix">YOU://</div>
        <div class="msg-content user-content">${question}</div>
      </div>`;
      input.value = "";
      chat.scrollTop = chat.scrollHeight;

      const loadingId = "load_" + Date.now();
      chat.innerHTML += `
      <div class="msg-block" id="${loadingId}">
        <div class="msg-prefix bot-prefix">SYS://</div>
        <div class="msg-content">
          <div class="loading-dots">
            <span></span><span></span><span></span>
          </div>
        </div>
      </div>`;
      chat.scrollTop = chat.scrollHeight;

      try {
        const res = await fetch("/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            query: question,
            mode: currentMode || 'strict',
            filters: getActiveFilters(),
          })
        });
        const data = await res.json();

        const sources = data.sources?.length
          ? `<div class="sources-block">‚ñ∏ SOURCE: ${data.sources.join(" ¬∑ ")}${data.mode ? ` &nbsp;|&nbsp; MODE: <span style="color:var(--accent);text-transform:uppercase">${data.mode}</span>` : ''}</div>`
          : "";

        let mediaHtml = "";
        if (data.media && data.media.length > 0) {
          const mediaItems = data.media.map(item => {
            const url = "/media/" + item.path.replace("data/", "");
            if (item.type === "image") {
              return `<div class="media-item">
              <img src="${url}" alt="${item.filename}">
              <div class="media-label">‚ñ∏ ${item.filename}</div>
            </div>`;
            } else {
              return `<div class="media-item">
              <video controls>
                <source src="${url}">
              </video>
              <div class="media-label">‚ñ∏ ${item.filename}</div>
            </div>`;
            }
          }).join("");
          mediaHtml = `<div class="media-block">${mediaItems}</div>`;
        }

        document.getElementById(loadingId).outerHTML = `
        <div class="msg-block">
          <div class="msg-prefix bot-prefix">SYS://</div>
          <div class="msg-content">${data.answer}${sources}${mediaHtml}</div>
        </div>`;

      } catch (err) {
        document.getElementById(loadingId).outerHTML = `
        <div class="msg-block">
          <div class="msg-prefix bot-prefix">ERR://</div>
          <div class="msg-content" style="color:#c0392b">Connection failed. Ensure server is running.</div>
        </div>`;
      }

      chat.scrollTop = chat.scrollHeight;
    }

    // ‚îÄ‚îÄ SIDEBAR LOGIC ‚îÄ‚îÄ

    // Collapsible sections
    function toggleSection(id) {
      const sec = document.getElementById(id);
      sec.classList.toggle('collapsed');
      // Persist collapse state
      const collapsed = JSON.parse(localStorage.getItem('sb-collapsed') || '{}');
      collapsed[id] = sec.classList.contains('collapsed');
      localStorage.setItem('sb-collapsed', JSON.stringify(collapsed));
    }

    // Restore collapse states on load
    (function restoreCollapseState() {
      const collapsed = JSON.parse(localStorage.getItem('sb-collapsed') || '{}');
      Object.entries(collapsed).forEach(([id, isCollapsed]) => {
        const el = document.getElementById(id);
        if (el && isCollapsed) el.classList.add('collapsed');
        else if (el) el.classList.remove('collapsed');
      });
    })();

    // ‚îÄ‚îÄ RECENT QUERIES ‚îÄ‚îÄ
    const MAX_RECENT = 8;

    function getRecentQueries() {
      return JSON.parse(localStorage.getItem('recent-queries') || '[]');
    }

    function saveQuery(query) {
      const recent = getRecentQueries().filter(q => q !== query);
      recent.unshift(query);
      if (recent.length > MAX_RECENT) recent.splice(MAX_RECENT);
      localStorage.setItem('recent-queries', JSON.stringify(recent));
      renderRecentQueries();
      // Update debug count
      const count = parseInt(document.getElementById('dbg-query-count').textContent || '0') + 1;
      document.getElementById('dbg-query-count').textContent = count;
    }

    function renderRecentQueries() {
      const container = document.getElementById('recent-queries');
      const queries = getRecentQueries();
      if (!queries.length) {
        container.innerHTML = '<div class="sb-recent-empty">No queries yet.</div>';
        return;
      }
      container.innerHTML = queries.map(q =>
        `<div class="sb-recent-item" onclick="fillQueryFromSidebar(this)" title="${q}">
         <span class="sb-recent-icon">‚ñ∏</span>
         <span style="overflow:hidden;text-overflow:ellipsis">${q}</span>
       </div>`
      ).join('');
    }

    function fillQueryFromSidebar(el) {
      const text = el.querySelector('span:last-child').textContent.trim();
      document.getElementById('input').value = text;
      document.getElementById('input').focus();
    }

    // Render on load
    renderRecentQueries();

    // ‚îÄ‚îÄ ENTITY INJECTION ‚îÄ‚îÄ
    function insertEntity(name) {
      const input = document.getElementById('input');
      const current = input.value.trim();
      input.value = current ? current + ' ' + name : name;
      input.focus();
      // Brief flash effect on the sidebar section header
      const head = document.querySelector('#sec-figures .sb-label');
      head.style.color = 'var(--accent)';
      setTimeout(() => { head.style.color = ''; }, 600);
    }

    // ‚îÄ‚îÄ FILTER TOGGLES ‚îÄ‚îÄ
    function toggleFilter(el) {
      el.classList.toggle('on');
      const state = JSON.parse(localStorage.getItem('sb-filters') || '{}');
      state[el.dataset.filter] = el.classList.contains('on');
      localStorage.setItem('sb-filters', JSON.stringify(state));
    }

    // Returns array of active filter keys to send to the backend
    // e.g. ['court', 'depo'] ‚Äî if all are on (or all off), returns null (no filtering)
    function getActiveFilters() {
      const toggles = document.querySelectorAll('.sb-toggle[data-filter]');
      const allKeys = Array.from(toggles).map(el => el.dataset.filter);
      const activeKeys = Array.from(toggles)
        .filter(el => el.classList.contains('on'))
        .map(el => el.dataset.filter);
      // If all filters are on or all are off, don't restrict ‚Äî return null
      if (activeKeys.length === 0 || activeKeys.length === allKeys.length) return null;
      return activeKeys;
    }

    // Restore filter states
   (function restoreFilters() {
  const state = JSON.parse(localStorage.getItem('sb-filters') || '{}');
  document.querySelectorAll('.sb-toggle[data-filter]').forEach(el => {
    const saved = state[el.dataset.filter];
    // Default is ON ‚Äî only turn off if explicitly saved as false
    if (saved === false) {
      el.classList.remove('on');
    } else {
      el.classList.add('on');
    }
  });
})();

    // ‚îÄ‚îÄ AI MODE TOGGLE ‚îÄ‚îÄ
    let currentMode = localStorage.getItem('ai-mode') || 'strict';

    function setMode(btn) {
      document.querySelectorAll('.sb-mode-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentMode = btn.dataset.mode;
      localStorage.setItem('ai-mode', currentMode);
      // Update breadcrumb hint
      const modeLabels = { strict: 'STRICT EVIDENCE', summary: 'SUMMARY MODE', timeline: 'TIMELINE MODE' };
      const hint = document.querySelector('.input-hint');
      if (hint) {
        hint.textContent = `Mode: ${modeLabels[currentMode]} ¬∑ Press ENTER to send`;
      }
    }

    // Restore AI mode
    (function restoreMode() {
      const saved = localStorage.getItem('ai-mode') || 'strict';
      const btn = document.querySelector(`.sb-mode-btn[data-mode="${saved}"]`);
      if (btn) {
        document.querySelectorAll('.sb-mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      }
    })();

    // ‚îÄ‚îÄ SIDEBAR sendMessage wrapper ‚îÄ‚îÄ
    // Wraps _sendMessageCore to add recent queries + live latency to debug panel
    async function sendMessage() {
      const input = document.getElementById('input');
      const question = input.value.trim();
      if (!question) return;
      const t0 = Date.now();
      saveQuery(question);
      await _sendMessageCore();
      const elapsed = Date.now() - t0;
      document.getElementById('dbg-latency').textContent = elapsed + ' ms';
    }
  </script>

</body>

</html>