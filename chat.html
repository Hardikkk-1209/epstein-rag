<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Epstein Files ‚Äî Research Terminal</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;1,300&family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    
    :root {
      --bg: #080808;
      --surface: #0f0f0f;
      --surface2: #141414;
      --border: rgba(255,255,255,0.06);
      --accent: #e8c547;
      --accent-dim: rgba(232,197,71,0.12);
      --accent-glow: rgba(232,197,71,0.04);
      --red: #c0392b;
      --text: #d4d0c8;
      --text-dim: #5a5650;
      --text-muted: #3a3632;
      --user-bg: #131313;
      --bot-bg: #0c0c0c;
      --toggle-bg: #1a1a1a;
      --toggle-border: rgba(255,255,255,0.1);
    }

    [data-theme="light"] {
      --bg: #f5f0e8;
      --surface: #ede8dc;
      --surface2: #e5dfd0;
      --border: rgba(0,0,0,0.08);
      --accent: #b8860b;
      --accent-dim: rgba(184,134,11,0.1);
      --accent-glow: rgba(184,134,11,0.04);
      --red: #c0392b;
      --text: #000000;
      --text-dim: #000000;
      --text-muted: #000000;
      --user-bg: #ede8dc;
      --bot-bg: #f0ebe0;
      --toggle-bg: #ddd8cc;
      --toggle-border: rgba(0,0,0,0.1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'IBM Plex Mono', monospace;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Scanline effect - only in dark mode */
    [data-theme="dark"] body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0,0,0,0.03) 2px,
        rgba(0,0,0,0.03) 4px
      );
      pointer-events: none;
      z-index: 1000;
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      opacity: 0.025;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 999;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      height: 56px;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      flex-shrink: 0;
      position: relative;
      z-index: 10;
      transition: background 0.3s ease, border-color 0.3s ease;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-text {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 22px;
      letter-spacing: 0.15em;
      color: var(--accent);
    }

    .header-divider {
      width: 1px;
      height: 20px;
      background: var(--border);
    }

    .header-sub {
      font-size: 10px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-dim);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .status-dot {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #2ecc71;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .doc-count {
      font-size: 10px;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      background: var(--surface2);
      border: 1px solid var(--border);
      padding: 4px 10px;
      border-radius: 4px;
    }

    .doc-count span { color: var(--accent); }

    /* ‚îÄ‚îÄ THEME TOGGLE ‚îÄ‚îÄ */
    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 6px 12px;
      background: var(--toggle-bg);
      border: 1px solid var(--toggle-border);
      border-radius: 20px;
      transition: all 0.2s ease;
      user-select: none;
    }

    .theme-toggle:hover {
      border-color: var(--accent);
    }

    .toggle-track {
      width: 32px;
      height: 16px;
      background: var(--border);
      border-radius: 8px;
      position: relative;
      transition: background 0.3s ease;
      border: 1px solid var(--toggle-border);
    }

    [data-theme="light"] .toggle-track {
      background: var(--accent-dim);
      border-color: var(--accent);
    }

    .toggle-thumb {
      width: 10px;
      height: 10px;
      background: var(--text-dim);
      border-radius: 50%;
      position: absolute;
      top: 2px;
      left: 2px;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .toggle-thumb {
      left: 18px;
      background: var(--accent);
    }

    .toggle-icon {
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .toggle-label {
      font-size: 9px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
      transition: color 0.3s ease;
    }

    /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
    .layout {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
    .sidebar {
      width: 220px;
      border-right: 1px solid var(--border);
      background: var(--surface);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      padding: 24px 0;
      transition: background 0.3s ease, border-color 0.3s ease;
    }

    .sidebar-label {
      font-size: 9px;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 0 20px;
      margin-bottom: 12px;
    }

    .sidebar-item {
      padding: 10px 20px;
      font-size: 11px;
      color: var(--text-dim);
      letter-spacing: 0.05em;
      cursor: pointer;
      border-left: 2px solid transparent;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-item:hover {
      color: var(--text);
      background: var(--accent-glow);
      border-left-color: var(--accent);
    }

    .sidebar-item.active {
      color: var(--accent);
      background: var(--accent-dim);
      border-left-color: var(--accent);
    }

    .sidebar-icon {
      font-size: 13px;
      opacity: 0.6;
    }

    .sidebar-divider {
      border: none;
      border-top: 1px solid var(--border);
      margin: 20px 0;
    }

    .sidebar-warning {
      margin: 0 16px;
      padding: 12px;
      background: rgba(192,57,43,0.08);
      border: 1px solid rgba(192,57,43,0.2);
      border-radius: 6px;
      font-size: 9px;
      line-height: 1.6;
      color: rgba(192,57,43,0.8);
      letter-spacing: 0.05em;
    }

    /* ‚îÄ‚îÄ CHAT AREA ‚îÄ‚îÄ */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .breadcrumb {
      padding: 10px 32px;
      font-size: 10px;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .breadcrumb span { color: var(--text-dim); }

    #chat {
      flex: 1;
      overflow-y: auto;
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 0;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }

    #chat::-webkit-scrollbar { width: 4px; }
    #chat::-webkit-scrollbar-track { background: transparent; }
    #chat::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    .msg-block {
      display: flex;
      gap: 16px;
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
      animation: fadeIn 0.3s ease;
    }

    .msg-block:last-child { border-bottom: none; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .msg-prefix {
      font-size: 11px;
      letter-spacing: 0.1em;
      min-width: 80px;
      padding-top: 2px;
      flex-shrink: 0;
    }

    .msg-prefix.user-prefix { color: var(--accent); }
    .msg-prefix.bot-prefix { color: var(--red); }

    .msg-content {
      flex: 1;
      font-size: 13px;
      line-height: 1.8;
      color: var(--text);
      letter-spacing: 0.02em;
    }

    .msg-content.user-content {
      color: var(--text-dim);
    }

    .sources-block {
      margin-top: 12px;
      padding: 10px 14px;
      background: var(--accent-dim);
      border: 1px solid rgba(232,197,71,0.15);
      border-radius: 4px;
      font-size: 10px;
      letter-spacing: 0.12em;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .loading-dots {
      display: flex;
      gap: 4px;
      align-items: center;
      padding-top: 4px;
    }

    .loading-dots span {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--accent);
      animation: blink 1.2s infinite;
    }

    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes blink {
      0%, 80%, 100% { opacity: 0.2; transform: scale(0.8); }
      40% { opacity: 1; transform: scale(1); }
    }

    .welcome {
      padding: 32px 0;
      border-bottom: 1px solid var(--border);
    }

    .welcome-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      letter-spacing: 0.1em;
      color: var(--accent);
      margin-bottom: 12px;
      line-height: 1;
    }

    .welcome-desc {
      font-size: 12px;
      line-height: 1.8;
      color: var(--text-dim);
      max-width: 560px;
      letter-spacing: 0.03em;
    }

    .suggested {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 20px;
    }

    .suggested-btn {
      padding: 8px 14px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.03em;
    }

    .suggested-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-dim);
    }

    /* ‚îÄ‚îÄ INPUT AREA ‚îÄ‚îÄ */
    .input-area {
      padding: 20px 32px;
      border-top: 1px solid var(--border);
      background: var(--surface);
      flex-shrink: 0;
      transition: background 0.3s ease;
    }

    .input-wrapper {
      display: flex;
      align-items: center;
      gap: 0;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
      transition: border-color 0.2s;
    }

    .input-wrapper:focus-within {
      border-color: rgba(232,197,71,0.4);
    }

    .input-prompt {
      padding: 0 16px;
      font-size: 13px;
      color: var(--accent);
      letter-spacing: 0.05em;
      flex-shrink: 0;
      border-right: 1px solid var(--border);
      height: 48px;
      display: flex;
      align-items: center;
    }

    input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text);
      padding: 14px 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      outline: none;
      letter-spacing: 0.03em;
    }

    input::placeholder { color: var(--text-muted); }

    button {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 0 24px;
      height: 48px;
      cursor: pointer;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 16px;
      letter-spacing: 0.15em;
      transition: opacity 0.2s;
      flex-shrink: 0;
    }

    button:hover { opacity: 0.85; }
    button:active { opacity: 0.7; }

    .input-hint {
      margin-top: 10px;
      font-size: 10px;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .input-hint kbd {
      background: var(--surface2);
      border: 1px solid var(--border);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: inherit;
      font-size: 9px;
    }

    .media-block {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .media-item {
      border: 1px solid rgba(232,197,71,0.2);
      border-radius: 6px;
      overflow: hidden;
      max-width: 280px;
    }

    .media-item img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      display: block;
    }

    .media-item video {
      width: 100%;
      height: 160px;
      object-fit: cover;
      display: block;
    }

    .media-label {
      padding: 6px 10px;
      font-size: 9px;
      letter-spacing: 0.1em;
      color: var(--accent);
      background: var(--accent-dim);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 768px) {
      .sidebar { display: none; }
      header { padding: 0 20px; }
      #chat { padding: 20px; }
      .input-area { padding: 16px 20px; }
      .header-sub { display: none; }
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="header-left">
    <div class="logo-text">EPSTEIN FILES</div>
    <div class="header-divider"></div>
    <div class="header-sub">Epstein Document Intelligence</div>
  </div>
  <div class="header-right">
    <div class="status-dot">
      <div class="dot"></div>
      SYSTEM ONLINE
    </div>
    <div class="doc-count">INDEXED: <span>33715</span> CHUNKS</div>

    <!-- THEME TOGGLE -->
    <div class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
      <span class="toggle-icon" id="toggle-icon">üåô</span>
      <div class="toggle-track">
        <div class="toggle-thumb"></div>
      </div>
      <span class="toggle-label" id="toggle-label">DARK</span>
    </div>
  </div>
</header>

<!-- LAYOUT -->
<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="sidebar-label">Navigation</div>
    <div class="sidebar-item active">
      <span class="sidebar-icon">‚¨°</span> Research Terminal
    </div>
    <div class="sidebar-item">
      <span class="sidebar-icon">‚óà</span> Document Index
    </div>
    <div class="sidebar-item">
      <span class="sidebar-icon">‚óé</span> Key Figures
    </div>
    <div class="sidebar-item">
      <span class="sidebar-icon">‚óá</span> Timeline
    </div>

    <hr class="sidebar-divider">

    <div class="sidebar-label">Sources</div>
    <div class="sidebar-item">
      <span class="sidebar-icon">‚ñ∏</span> Court Documents
    </div>
    <div class="sidebar-item">
      <span class="sidebar-icon">‚ñ∏</span> SDNY Filings
    </div>
    <div class="sidebar-item">
      <span class="sidebar-icon">‚ñ∏</span> Giuffre v Maxwell
    </div>

    <hr class="sidebar-divider">

    <div class="sidebar-warning">
      ‚ö† FOR RESEARCH PURPOSES ONLY. CONTENT SOURCED FROM PUBLIC COURT RECORDS.
    </div>
  </div>

  <!-- CHAT -->
  <div class="chat-container">
    <div class="breadcrumb">
      EPSTEIN-RAG / <span>research-terminal</span> / <span>active-session</span>
    </div>

    <div id="chat">
      <div class="welcome">
        <div class="welcome-title">RESEARCH TERMINAL</div>
        <div class="welcome-desc">
          Query the Epstein court document database. All responses are sourced strictly from indexed legal documents. This system will not speculate beyond available evidence.
        </div>
        <div class="suggested">
          <div class="suggested-btn" onclick="fillQuery(this)">Who is Ghislaine Maxwell?</div>
          <div class="suggested-btn" onclick="fillQuery(this)">What is Case 18-2868?</div>
          <div class="suggested-btn" onclick="fillQuery(this)">What did Virginia Giuffre claim?</div>
          <div class="suggested-btn" onclick="fillQuery(this)">What court ordered the unsealing?</div>
        </div>
      </div>
    </div>

    <!-- INPUT -->
    <div class="input-area">
      <div class="input-wrapper">
        <div class="input-prompt">QUERY://</div>
        <input id="input" type="text"
               placeholder="Enter your research query..."
               onkeydown="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">EXECUTE</button>
      </div>
      <div class="input-hint">Press <kbd>ENTER</kbd> to send ¬∑ Responses sourced from indexed documents only</div>
    </div>
  </div>

</div>

<script>
  // ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ
  function toggleTheme() {
    const html = document.documentElement;
    const isDark = html.getAttribute("data-theme") === "dark";
    html.setAttribute("data-theme", isDark ? "light" : "dark");
    document.getElementById("toggle-icon").textContent = isDark ? "‚òÄÔ∏è" : "üåô";
    document.getElementById("toggle-label").textContent = isDark ? "LIGHT" : "DARK";
    localStorage.setItem("theme", isDark ? "light" : "dark");
  }

  // Restore saved theme on load
  const savedTheme = localStorage.getItem("theme") || "dark";
  document.documentElement.setAttribute("data-theme", savedTheme);
  if (savedTheme === "light") {
    document.getElementById("toggle-icon").textContent = "‚òÄÔ∏è";
    document.getElementById("toggle-label").textContent = "LIGHT";
  }

  // ‚îÄ‚îÄ Chat ‚îÄ‚îÄ
  function fillQuery(el) {
    document.getElementById("input").value = el.textContent;
    document.getElementById("input").focus();
  }

  async function sendMessage() {
    const input = document.getElementById("input");
    const chat = document.getElementById("chat");
    const question = input.value.trim();
    if (!question) return;

    chat.innerHTML += `
      <div class="msg-block">
        <div class="msg-prefix user-prefix">YOU://</div>
        <div class="msg-content user-content">${question}</div>
      </div>`;
    input.value = "";
    chat.scrollTop = chat.scrollHeight;

    const loadingId = "load_" + Date.now();
    chat.innerHTML += `
      <div class="msg-block" id="${loadingId}">
        <div class="msg-prefix bot-prefix">SYS://</div>
        <div class="msg-content">
          <div class="loading-dots">
            <span></span><span></span><span></span>
          </div>
        </div>
      </div>`;
    chat.scrollTop = chat.scrollHeight;

    try {
      const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question })
      });
      const data = await res.json();

      const sources = data.sources?.length
        ? `<div class="sources-block">‚ñ∏ SOURCE: ${data.sources.join(" ¬∑ ")}</div>`
        : "";

      let mediaHtml = "";
      if (data.media && data.media.length > 0) {
        const mediaItems = data.media.map(item => {
          const url = "/media/" + item.path.replace("data/", "");
          if (item.type === "image") {
            return `<div class="media-item">
              <img src="${url}" alt="${item.filename}">
              <div class="media-label">‚ñ∏ ${item.filename}</div>
            </div>`;
          } else {
            return `<div class="media-item">
              <video controls>
                <source src="${url}">
              </video>
              <div class="media-label">‚ñ∏ ${item.filename}</div>
            </div>`;
          }
        }).join("");
        mediaHtml = `<div class="media-block">${mediaItems}</div>`;
      }

      document.getElementById(loadingId).outerHTML = `
        <div class="msg-block">
          <div class="msg-prefix bot-prefix">SYS://</div>
          <div class="msg-content">${data.answer}${sources}${mediaHtml}</div>
        </div>`;

    } catch (err) {
      document.getElementById(loadingId).outerHTML = `
        <div class="msg-block">
          <div class="msg-prefix bot-prefix">ERR://</div>
          <div class="msg-content" style="color:#c0392b">Connection failed. Ensure server is running.</div>
        </div>`;
    }

    chat.scrollTop = chat.scrollHeight;
  }
</script>

</body>
</html>